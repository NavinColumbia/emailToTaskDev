{% extends "base.html" %}

{% block title %}Fetch Emails - Taskflow{% endblock %}

{% block content %}
<div class="notion-slide-up">
    <div class="notion-card">
        <div class="notion-card-header">
            <h1 class="notion-card-title">
                <i class="bi bi-download notion-icon" style="color: var(--notion-accent);"></i>
                Fetch and Process Emails
            </h1>
            <p class="notion-card-subtitle">Configure your search parameters and process emails from your Gmail account.</p>
        </div>
        
        <form id="fetchForm" class="notion-mb-xl" method="post" action="/api/fetch-emails">
            <div class="notion-grid notion-grid-4">
                <div class="notion-form-group">
                    <label for="provider" class="notion-label">Task Provider</label>
                    <select class="notion-select" id="provider" name="provider">
                        <option value="todoist" selected>Todoist</option>
                    </select>
                </div>
                <div class="notion-form-group">
                    <label for="label" class="notion-label">Gmail Label</label>
                    <input type="text" class="notion-input" id="label" name="label" value="todoist-forward" placeholder="Gmail label">
                </div>
                <div class="notion-form-group">
                    <label for="max" class="notion-label">Max Emails</label>
                    <input type="number" class="notion-input" id="max" name="max" value="10" min="1" max="100">
                </div>
                <div class="notion-form-group">
                    <label for="window" class="notion-label">Time Window</label>
                    <select class="notion-select" id="window" name="window">
                        <option value="">All emails</option>
                        <option value="1d">Last 24 hours</option>
                        <option value="7d">Last 7 days</option>
                        <option value="30d">Last 30 days</option>
                    </select>
                </div>
            </div>
            <div class="notion-flex notion-gap-md">
                <button type="submit" class="notion-btn notion-btn-primary notion-btn-lg" id="fetchBtn">
                    <i class="bi bi-download notion-icon"></i> Fetch Emails
                </button>
            </div>
        </form>

        <div id="error" class="notion-alert notion-alert-error notion-hidden">
            <i class="bi bi-exclamation-triangle notion-icon"></i>
            <div>
                <h4>Error</h4>
                <div id="errorContent"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Load saved settings on page load
document.addEventListener('DOMContentLoaded', function() {
    const savedSettings = localStorage.getItem('emailToTaskSettings');
    if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        Object.keys(settings).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
                element.value = settings[key];
            }
        });
    }
});

</script>
{% endblock %}
